<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tidyprompt R6 Class — tidyprompt-class • tidyprompt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tidyprompt R6 Class — tidyprompt-class"><meta name="description" content="A tidyprompt object contains a base prompt and a list
of prompt_wrap() objects. It provides structured methods to modify the prompt
while simultaneously adding logic to extract from and validate the LLM response.
Besides a base prompt, a tidyprompt object may contain a system prompt
and a chat history which precede the base prompt."><meta property="og:description" content="A tidyprompt object contains a base prompt and a list
of prompt_wrap() objects. It provides structured methods to modify the prompt
while simultaneously adding logic to extract from and validate the LLM response.
Besides a base prompt, a tidyprompt object may contain a system prompt
and a chat history which precede the base prompt."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyprompt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_prompt_wraps.html">Creating prompt wraps</a></li>
    <li><a class="dropdown-item" href="../articles/getting_started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/sentiment_analysis.html">Sentiment analysis in R with a LLM and 'tidyprompt'</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tjarkvandemerwe/tidyprompt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tidyprompt R6 Class</h1>
      <small class="dont-index">Source: <a href="https://github.com/tjarkvandemerwe/tidyprompt/blob/main/R/tidyprompt.R" class="external-link"><code>R/tidyprompt.R</code></a></small>
      <div class="d-none name"><code>tidyprompt-class.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A tidyprompt object contains a base prompt and a list
of <code><a href="prompt_wrap.html">prompt_wrap()</a></code> objects. It provides structured methods to modify the prompt
while simultaneously adding logic to extract from and validate the LLM response.
Besides a base prompt, a tidyprompt object may contain a system prompt
and a chat history which precede the base prompt.</p>
    </div>


    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other tidyprompt:
<code><a href="construct_prompt_text.html">construct_prompt_text</a>()</code>,
<code><a href="get_chat_history.html">get_chat_history</a>()</code>,
<code><a href="get_prompt_wraps.html">get_prompt_wraps</a>()</code>,
<code><a href="is_tidyprompt.html">is_tidyprompt</a>()</code>,
<code><a href="set_chat_history.html">set_chat_history</a>()</code>,
<code><a href="tidyprompt.html">tidyprompt</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="public-fields">Public fields<a class="anchor" aria-label="anchor" href="#public-fields"></a></h2>
    <p></p><div class="r6-fields"><dl><dt><code>base_prompt</code></dt>
<dd><p>The base prompt string.
The base prompt be modified by prompt wraps during <code><a href="construct_prompt_text.html">construct_prompt_text()</a></code>;
the modified prompt text will be used as the final message of role 'user'
during <code><a href="send_prompt.html">send_prompt()</a></code></p></dd>


<dt><code>system_prompt</code></dt>
<dd><p>A system prompt string.
This will be added at the start of the chat history as role 'system'
during <code><a href="send_prompt.html">send_prompt()</a></code></p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-Tidyprompt-new"><code>tidyprompt-class$new()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-is_valid"><code>tidyprompt-class$is_valid()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-add_prompt_wrap"><code>tidyprompt-class$add_prompt_wrap()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-get_prompt_wraps"><code>tidyprompt-class$get_prompt_wraps()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-construct_prompt_text"><code>tidyprompt-class$construct_prompt_text()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-set_chat_history"><code>tidyprompt-class$set_chat_history()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-get_chat_history"><code>tidyprompt-class$get_chat_history()</code></a></p></li>
<li><p><a href="#method-Tidyprompt-clone"><code>tidyprompt-class$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-Tidyprompt-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Initialize a tidyprompt object</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>input</code></dt>
<dd><p>A string, a chat history, a list containing
a chat history under key '$chat_history', or a tidyprompt object</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h4>
<p>Different types of input are accepted for initialization of
a tidyprompt object:</p><ul><li><p>A single character string. This will be used as the base prompt</p></li>
<li><p>A dataframe which is a valid chat history (see <code><a href="chat_history.html">chat_history()</a></code>)</p></li>
<li><p>A list containing a valid chat history under '$chat_history'
(e.g., a result from <code><a href="send_prompt.html">send_prompt()</a></code> when using 'return_mode' = "full")</p></li>
<li><p>A tidyprompt object. This will be checked for validity and, if valid,
the fields are copied to the object which is returned from this method</p></li>
</ul><p>When passing a dataframe or list with a chat history, the last row of the
chat history must have role 'user'; this row will be used as the base prompt.
If the first row of the chat history has role 'system', it will be used
as the system prompt.</p>
</div>

<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A tidyprompt object</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-is_valid"></a><div class="section">
<h3 id="method-is-valid-">Method <code>is_valid()</code><a class="anchor" aria-label="anchor" href="#method-is-valid-"></a></h3>
<p>Check if the tidyprompt object is valid.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">is_valid</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p><code>TRUE</code> if valid, otherwise <code>FALSE</code></p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-add_prompt_wrap"></a><div class="section">
<h3 id="method-add-prompt-wrap-">Method <code>add_prompt_wrap()</code><a class="anchor" aria-label="anchor" href="#method-add-prompt-wrap-"></a></h3>
<p>Add a <code><a href="prompt_wrap.html">prompt_wrap()</a></code> to the tidyprompt object.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">add_prompt_wrap</span><span class="op">(</span><span class="va">prompt_wrap</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>prompt_wrap</code></dt>
<dd><p>A <code><a href="prompt_wrap.html">prompt_wrap()</a></code> object</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>The updated tidyprompt object</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-get_prompt_wraps"></a><div class="section">
<h3 id="method-get-prompt-wraps-">Method <code><a href="get_prompt_wraps.html">get_prompt_wraps()</a></code><a class="anchor" aria-label="anchor" href="#method-get-prompt-wraps-"></a></h3>
<p>Get list of <code><a href="prompt_wrap.html">prompt_wrap()</a></code> objects from the tidyprompt object.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">get_prompt_wraps</span><span class="op">(</span></span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"default"</span>, <span class="st">"modification"</span>, <span class="st">"evaluation"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>order</code></dt>
<dd><p>The order to return the wraps. Options are:</p><ul><li><p>"default": as originally added to the object</p></li>
<li><p>"modification": as ordered for modification of the base prompt;
ordered by type: check, unspecified, mode, tool, break. This is the order
in which prompt wraps are applied during <code><a href="construct_prompt_text.html">construct_prompt_text()</a></code></p></li>
<li><p>"evaluation": ordered for evaluation of the LLM response;
ordered by type: tool, mode, break, unspecified, check. This is the order
in which wraps are applied to the LLM output during <code><a href="send_prompt.html">send_prompt()</a></code></p></li>
</ul></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>A list of <code><a href="prompt_wrap.html">prompt_wrap()</a></code> objects.</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-construct_prompt_text"></a><div class="section">
<h3 id="method-construct-prompt-text-">Method <code><a href="construct_prompt_text.html">construct_prompt_text()</a></code><a class="anchor" aria-label="anchor" href="#method-construct-prompt-text-"></a></h3>
<p>Construct the complete prompt text.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">construct_prompt_text</span><span class="op">(</span>llm_provider <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>llm_provider</code></dt>
<dd><p>Optional <a href="llm_provider-class.html">llm_provider</a> object.
This may sometimes affect the prompt text construction</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p>A string representing the constructed prompt text</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-set_chat_history"></a><div class="section">
<h3 id="method-set-chat-history-">Method <code><a href="set_chat_history.html">set_chat_history()</a></code><a class="anchor" aria-label="anchor" href="#method-set-chat-history-"></a></h3>
<p>This function sets the chat history for the tidyprompt object.
The chat history will also set the base prompt and system prompt
(the last message of the chat history should be of role 'user' and
will be used as the base prompt; the first message of the chat history
may be of the role 'system' and will then be used as the system prompt).
This may be useful when one wants to change the base prompt, system prompt,
and chat history of a tidyprompt object while retaining other fields like
the prompt wraps.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">set_chat_history</span><span class="op">(</span><span class="va">chat_history</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>chat_history</code></dt>
<dd><p>A valid chat history (see <code><a href="chat_history.html">chat_history()</a></code>)</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-5">Returns<a class="anchor" aria-label="anchor" href="#returns-5"></a></h4>
<p>The updated tidyprompt object</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-get_chat_history"></a><div class="section">
<h3 id="method-get-chat-history-">Method <code><a href="get_chat_history.html">get_chat_history()</a></code><a class="anchor" aria-label="anchor" href="#method-get-chat-history-"></a></h3>
<p>This function gets the chat history of the tidyprompt object.
The chat history is constructed from the base prompt, system prompt, and chat
history field. The returned object will be the chat history
with the system prompt as the first message with role 'system' and the
the base prompt as the last message with role 'user'.</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">get_chat_history</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-6">Returns<a class="anchor" aria-label="anchor" href="#returns-6"></a></h4>
<p>A dataframe containing the chat history</p>
</div>

</div><p></p><hr><a id="method-Tidyprompt-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">tidyprompt</span><span class="op">-</span><span class="va">class</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="tidyprompt.html">tidyprompt</a></span><span class="op">(</span><span class="st">"Hi!"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;tidyprompt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">The base prompt is not modified by prompt wraps:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>Hi! </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$base_prompt' to show the base prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$construct_prompt_text()' to get the full prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add to a tidyprompt using a prompt wrap:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="tidyprompt.html">tidyprompt</a></span><span class="op">(</span><span class="st">"Hi!"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_text.html">add_text</a></span><span class="op">(</span><span class="st">"How are you?"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;tidyprompt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">The base prompt is modified by a prompt wrap, resulting in:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>Hi!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>How are you? </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$base_prompt' to show the base prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$construct_prompt_text()' to get the full prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'get_prompt_wraps(x)' to show the prompt wraps.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Strings can be input for prompt wraps; therefore,</span></span></span>
<span class="r-in"><span><span class="co">#   a call to tidyprompt() is not necessary:</span></span></span>
<span class="r-in"><span><span class="st">"Hi"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_text.html">add_text</a></span><span class="op">(</span><span class="st">"How are you?"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">&lt;tidyprompt&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">The base prompt is modified by a prompt wrap, resulting in:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>Hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">&gt; </span>How are you? </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$base_prompt' to show the base prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'x$construct_prompt_text()' to get the full prompt text.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Use 'get_prompt_wraps(x)' to show the prompt wraps.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example of adding extraction &amp; validation with a prompt_wrap():</span></span></span>
<span class="r-in"><span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"Hi"</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_text.html">add_text</a></span><span class="op">(</span><span class="st">"What is 5 + 5?"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="answer_as_integer.html">answer_as_integer</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># tidyprompt objects are evaluated by send_prompt(), which will</span></span></span>
<span class="r-in"><span>  <span class="co">#   handle construct the prompt text, send it to the LLM provider,</span></span></span>
<span class="r-in"><span>  <span class="co">#   and apply the extraction and validation functions from the tidyprompt object</span></span></span>
<span class="r-in"><span>  <span class="va">prompt</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="send_prompt.html">send_prompt</a></span><span class="op">(</span><span class="fu"><a href="llm_provider_ollama.html">llm_provider_ollama</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Sending request to LLM provider (llama3.1:8b): ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   Hi</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co">#   What is 5 + 5?</span></span></span>
<span class="r-in"><span>  <span class="co">#</span></span></span>
<span class="r-in"><span>  <span class="co">#   You must answer with only an integer (use no other characters).</span></span></span>
<span class="r-in"><span>  <span class="co"># --- Receiving response from LLM provider: ---</span></span></span>
<span class="r-in"><span>  <span class="co">#   10</span></span></span>
<span class="r-in"><span>  <span class="co"># [1] 10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># See prompt_wrap() and send_prompt() for more details</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `tidyprompt` objects may be validated with these helpers:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="is_tidyprompt.html">is_tidyprompt</a></span><span class="op">(</span><span class="va">prompt</span><span class="op">)</span> <span class="co"># Returns TRUE if input is a valid tidyprompt object</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get base prompt text</span></span></span>
<span class="r-in"><span><span class="va">prompt</span><span class="op">$</span><span class="va">base_prompt</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Hi"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get all prompt wraps</span></span></span>
<span class="r-in"><span><span class="va">prompt</span><span class="op">$</span><span class="fu">get_prompt_wraps</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unspecified"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $modify_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (original_prompt_text, llm_provider = NULL, http_list = NULL) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (position == "after") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paste(original_prompt_text, text, sep = sep)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paste(text, original_prompt_text, sep = sep)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x563f242f22e0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extraction_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $validation_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $handler_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameter_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "add_text"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "prompt_wrap"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "unspecified"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $modify_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (original_prompt_text, llm_provider = NULL, http_list = NULL) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!add_instruction_to_prompt) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(original_prompt_text)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     glue::glue("{original_prompt_text}\n\n{instruction}")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x563f242f36d8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $extraction_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (x, llm_provider = NULL, http_list = NULL) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     extracted &lt;- suppressWarnings(as.numeric(x))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (is.na(extracted)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(llm_feedback(instruction))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(extracted)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x563f242f5748&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $validation_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (x, llm_provider = NULL, http_list = NULL) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (x != floor(x)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(llm_feedback(instruction))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is.null(min) &amp;&amp; x &lt; min) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(llm_feedback(glue::glue("The number should be greater than or equal to {min}.")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is.null(max) &amp;&amp; x &gt; max) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(llm_feedback(glue::glue("The number should be less than or equal to {max}.")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x563f24254138&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $handler_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parameter_fn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "answer_as_integer"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "prompt_wrap"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Construct prompt text</span></span></span>
<span class="r-in"><span><span class="va">prompt</span><span class="op">$</span><span class="fu">construct_prompt_text</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> What is 5 + 5?</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> You must answer with only an integer (use no other characters).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Configure chat history (affecting also the base prompt)</span></span></span>
<span class="r-in"><span><span class="va">chat_history</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"user"</span>, <span class="st">"assistant"</span>, <span class="st">"user"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"What is 5 + 5?"</span>, <span class="st">"10"</span>, <span class="st">"And what is 5 + 6?"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prompt</span><span class="op">$</span><span class="fu">set_chat_history</span><span class="op">(</span><span class="va">chat_history</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get chat history</span></span></span>
<span class="r-in"><span><span class="va">prompt</span><span class="op">$</span><span class="fu">get_chat_history</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   role      content                                                  tool_result</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> user      <span style="color: #949494;">"</span>What is 5 + 5?<span style="color: #949494;">"</span>                                         FALSE      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> assistant <span style="color: #949494;">"</span>10<span style="color: #949494;">"</span>                                                     FALSE      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> user      <span style="color: #949494;">"</span>And what is 5 + 6?\n\nWhat is 5 + 5?\n\nYou must answe… <span style="color: #BB0000;">NA</span>         </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning, Tjark Van de Merwe, Kennispunt Twente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

